@model checkpoint_web.Pages.Admin.Tareas.EditModel

@if (!string.IsNullOrEmpty(Model.Tarea.Historial))
{
    <div class="card mt-4">
        <div class="card-header bg-light">
       <h5 class="mb-0">?? Historial de Cambios</h5>
     </div>
        <div class="card-body">
    <div class="timeline">
    @try
          {
   var historial = System.Text.Json.JsonSerializer.Deserialize<List<System.Text.Json.JsonElement>>(Model.Tarea.Historial);
   if (historial != null && historial.Any())
          {
                 foreach (var entrada in historial.OrderByDescending(h => h.GetProperty("Fecha").GetDateTime()))
           {
     var fecha = entrada.GetProperty("Fecha").GetDateTime();
      var cambios = entrada.GetProperty("Cambios").EnumerateArray();

      <div class="timeline-item">
       <div class="timeline-marker"></div>
        <div class="timeline-content">
             <div class="timeline-date">
     @fecha.ToLocalTime().ToString("dd/MM/yyyy HH:mm")
      </div>
      <div class="timeline-body">
       <ul class="mb-0">
@foreach (var cambio in cambios)
       {
 <li>@cambio.GetString()</li>
        }
          </ul>
           </div>
              </div>
          </div>
   }
          }
    }
  catch
    {
    <div class="alert alert-warning">No se pudo cargar el historial</div>
}
   </div>
  </div>
    </div>

    <style>
   .timeline {
            position: relative;
   padding: 20px 0;
      list-style: none;
    }

 .timeline:before {
     content: '';
            position: absolute;
  top: 0;
  bottom: 0;
     width: 2px;
            background: #dee2e6;
  left: 15px;
          margin-left: -1px;
        }

        .timeline-item {
            position: relative;
     margin-bottom: 30px;
            padding-left: 45px;
   }

     .timeline-marker {
  position: absolute;
            left: 0;
      top: 0;
  width: 30px;
     height: 30px;
  border-radius: 50%;
   background: #0d6efd;
   border: 3px solid #fff;
          box-shadow: 0 0 0 3px #dee2e6;
   }

.timeline-content {
    background: #f8f9fa;
        border-radius: 8px;
   padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .timeline-date {
     font-size: 0.85rem;
            color: #6c757d;
     font-weight: 600;
          margin-bottom: 8px;
}

        .timeline-body {
  color: #212529;
        }

        .timeline-body ul {
            padding-left: 20px;
        }

        .timeline-body li {
       margin-bottom: 5px;
      }
    </style>
}

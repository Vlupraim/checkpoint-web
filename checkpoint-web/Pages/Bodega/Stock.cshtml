@page
@using checkpoint_web.Models
@model checkpoint_web.Pages.Bodega.StockModel
@{
    ViewData["Title"] = "Consulta de Stock";
    Layout = Request.Headers["X-Requested-With"] == "XMLHttpRequest" ? null : "/Pages/Shared/_BodegaLayout.cshtml";
}

<h2>Consulta de Stock Actual</h2>

<div class="row mb-3">
  <div class="col-md-12">
   <div class="card">
 <div class="card-header">
  <h5 class="mb-0">Filtros de Búsqueda</h5>
    </div>
   <div class="card-body">
           <form method="get">
   <div class="row">
        <div class="col-md-4">
   <label class="form-label">Producto</label>
    <input type="text" class="form-control" name="producto" placeholder="Buscar por nombre o SKU..." />
      </div>
    <div class="col-md-3">
      <label class="form-label">Sede</label>
 <select class="form-select" name="sedeId">
   <option value="">Todas las sedes</option>
         </select>
   </div>
   <div class="col-md-3">
 <label class="form-label">Ubicación</label>
     <select class="form-select" name="ubicacionId">
      <option value="">Todas las ubicaciones</option>
       </select>
    </div>
  <div class="col-md-2">
  <label class="form-label">&nbsp;</label>
   <button type="submit" class="btn btn-primary w-100">Buscar</button>
 </div>
   </div>
   </form>
</div>
  </div>
    </div>
</div>

<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
     <h5 class="mb-0">Stock por Producto y Ubicación</h5>
   <button class="btn btn-sm btn-success" onclick="exportToExcel()">
       <i class="bi bi-file-excel"></i> Exportar Excel
     </button>
    </div>
    <div class="card-body">
        @if (Model.Stocks.Any())
        {
 <div class="table-responsive">
     <table class="table table-striped table-hover">
     <thead>
    <tr>
   <th>Producto</th>
        <th>SKU</th>
      <th>Lote</th>
  <th>Sede</th>
  <th>Ubicación</th>
      <th>Cantidad</th>
       <th>Unidad</th>
    <th>Estado Lote</th>
   <th>Última Actualización</th>
     </tr>
       </thead>
    <tbody>
            @foreach (var stock in Model.Stocks)
            {
                var estadoClass = stock.Lote?.Estado switch
                {
                    EstadoLote.Liberado => "badge bg-success",
                    EstadoLote.Cuarentena => "badge bg-warning text-dark",
                    EstadoLote.Rechazado => "badge bg-danger",
                    EstadoLote.Bloqueado => "badge bg-dark",
                    _ => "badge bg-secondary"
                };
       <tr>
           <td><strong>@(stock.Lote?.Producto?.Nombre ?? "N/A")</strong></td>
           <td>@(stock.Lote?.Producto?.Sku ?? "-")</td>
           <td><small>@(stock.Lote?.CodigoLote ?? "-")</small></td>
           <td>@(stock.Ubicacion?.Sede?.Nombre ?? "N/A")</td>
           <td>@(stock.Ubicacion?.Codigo ?? "N/A")</td>
           <td><strong>@stock.Cantidad.ToString("N3")</strong></td>
           <td>@stock.Unidad</td>
           <td><span class="@estadoClass">@(stock.Lote?.Estado.ToString() ?? "N/A")</span></td>
           <td><small>@stock.ActualizadoEn.ToString("dd/MM/yyyy HH:mm")</small></td>
       </tr>
            }
        </tbody>
     </table>
</div>
        }
        else
        {
       <div class="alert alert-info text-center">
   <i class="bi bi-inbox" style="font-size: 2rem;"></i>
      <p class="mt-2 mb-0"><strong>No hay stock registrado</strong></p>
      <small>Los stocks aparecerán aquí después de registrar recepciones</small>
       </div>
        }
    </div>
</div>

@section Scripts {
    <script>
  function exportToExcel() {
  alert('Funcionalidad de exportación en desarrollo');
     }
    </script>
}

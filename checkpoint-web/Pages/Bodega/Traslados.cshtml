@page
@model checkpoint_web.Pages.Bodega.TrasladosModel
@{
    ViewData["Title"] = "Traslados entre Ubicaciones";
    Layout = Request.Headers["X-Requested-With"] == "XMLHttpRequest" ? null : "/Pages/Shared/_BodegaLayout.cshtml";
}

<h2>Traslados entre Ubicaciones</h2>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show">
        @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<div class="row mb-3">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Registrar Traslado</h5>
            </div>
            <div class="card-body">
                @* Solo mostrar ValidationSummary si hay errores *@
                @if (!ViewData.ModelState.IsValid)
                {
                    <div asp-validation-summary="All" class="alert alert-danger" role="alert"></div>
                }
                
                <form method="post">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="form-label text-white">Lote</label>
                            <select asp-for="LoteId" asp-items="Model.LotesDisponibles" class="form-select" required>
                                <option value="">Seleccionar Lote...</option>
                            </select>
                            <span asp-validation-for="LoteId" class="text-danger"></span>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label text-white">Ubicación Origen</label>
                            <select asp-for="OrigenId" asp-items="Model.UbicacionesOrigen" class="form-select" required>
                                <option value="">Seleccionar...</option>
                            </select>
                            <span asp-validation-for="OrigenId" class="text-danger"></span>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label text-white">Ubicación Destino</label>
                            <select asp-for="DestinoId" asp-items="Model.UbicacionesDestino" class="form-select" required>
                                <option value="">Seleccionar...</option>
                            </select>
                            <span asp-validation-for="DestinoId" class="text-danger"></span>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label text-white">Cantidad</label>
                            <input asp-for="Cantidad" type="number" class="form-control" step="0.01" required />
                            <span asp-validation-for="Cantidad" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="mt-3">
                        <button type="submit" class="btn btn-primary">Ejecutar Traslado</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h5 class="mb-0">Traslados Recientes</h5>
    </div>
    <div class="card-body">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Lote</th>
                    <th>Origen</th>
                    <th>Destino</th>
                    <th>Cantidad</th>
                    <th>Usuario</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.TrasladosRecientes.Any())
                {
                    @foreach (var tras in Model.TrasladosRecientes)
                    {
                        <tr>
                            <td>@tras.Fecha.ToString("dd/MM HH:mm")</td>
                            <td><small>@tras.Lote?.CodigoLote</small></td>
                            <td>@tras.OrigenUbicacion?.Codigo</td>
                            <td>@tras.DestinoUbicacion?.Codigo</td>
                            <td><strong>@tras.Cantidad.ToString("N2")</strong></td>
                            <td>@(tras.UsuarioId ?? "-")</td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="6" class="text-center text-muted">No hay traslados registrados</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
